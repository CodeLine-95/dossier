{extend name="public/nav" /}
{block name="title"} 档案列表 {/block}

{block name="content"}
<div class="site-content">
    <div class="layui-container" style="padding: 15px;">
        <span class="layui-breadcrumb">
            <a href="{:url('index/index/index')}">首页</a>
            <a><cite>档案管理</cite></a>
            <a><cite>档案列表</cite></a>
        </span>
        <div class="site-text" style="margin-top: 10px;">
            <button onclick="window.location.href = '/index/archives/add'"
                class="layui-btn layui-btn-sm layui-btn-radius">添加</button>
            <div  style="margin-top:10px;">
                <form class="layui-form" >
                    <div class="layui-form-item">
                        <div class="layui-input-block" style="margin-left:0px;">
                            <input type="text" name="name" value="{if condition='isset($param.name) && !empty($param.name)'}{$param.name}{/if}"  placeholder="档案名称/企业名称" autocomplete="off"
                                class="layui-input">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <div class="layui-input-block" style="margin-left:0px;">
                            <button class="layui-btn" type="submit">查询</button>
                        </div>
                    </div>
                </form>
            </div>
            <table class="layui-table">
                <colgroup>
                    <col width="80">
                    <col>
                    <col width="80">
                    <col width="80">
                    <col width="80">
                </colgroup>
                <thead>
                    <tr>
                        <th>编号</th>
                        <th>名称</th>
                        <th>公司</th>
                        <th>图片</th>
                        <th>状态</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody>
                    {foreach $archives as $g}
                    <tr>
                        <td>{$g.id}</td>
                        <td><a href="{:url('index/archives/show',array('id'=>$g.id))}">{$g.name}</a></td>
                        <td>{$g.branch_name}</td>
                        <td>
                            {if condition="!empty($g.pic)"}
                                <?php $pic_arr = json_decode($g['pic'],true); ?>
                                {foreach $pic_arr as $k=>$p}
                                    {if condition="$k < 4"} 
                                        <div><img src="{$p}" alt="{$p}"></div>
                                    {/if}
                                {/foreach}
                            {/if}
                        </td>
                        <td>
                            {switch $g.audit_status }
                                {case 1}处理中{/case}
                                {case 2}已归档{/case}
                                {case 3}已注销{/case}
                                {default /}未处理
                            {/switch}
                        </td>
                        <td>
                            <a href="{:url('index/archives/audit',array('id'=>$g.id))}">审核</a>
                            <a href="{:url('index/archives/edit',array('id'=>$g.id))}">编辑</a>
                            <a href="javascript:;" class="del" data-id="{$g.id}" data-name="{$g.name}">删除</a>
                        </td>
                    </tr>
                    {/foreach}
                </tbody>
            </table>
            {$archives->render()}
        </div>
    </div>
</div>
<script type="text/javascript">
    layui.use(['layer', 'jquery'], function () {
        var layer = layui.layer, $ = layui.jquery;
        //删除操作
        $('.del').click(function () {
            var id = $(this).data('id');
            var user_name = $(this).data('name');
            layer.confirm('您确定要删除 ( ' + user_name + ' ) ?', function () {
                $.post('{:url("index/archives/del")}', { id: id }, function (res) {
                    layer.msg(res.msg)
                    window.location.reload();
                }, 'json');
            });
        });

    });
</script>
{/block}